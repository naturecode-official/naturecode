# NatureCode 1.2.4 - 文件系统访问功能演示

## 新功能概述

NatureCode 1.2.4 新增了本地文件系统访问功能，让 AI 能够：

- 浏览当前目录的文件和文件夹
- 读取文件内容
- 创建和编辑文件
- 删除文件（带自动备份）
- 搜索文件
- 查看操作日志

## 快速开始

### 1. 启动 NatureCode

```bash
naturecode start
```

### 2. 基本文件操作示例

#### 查看当前目录

```
> ls
> list files
> 显示当前目录的文件
```

#### 读取文件

```
> cat package.json
> read src/cli/index.js
> 查看配置文件
```

#### 创建文件

```
> create test.js
> 创建一个新的Python脚本
```

#### 编辑文件

```
> edit README.md
> 修改配置文件
```

#### 删除文件

```
> delete temp.txt
> 移除旧文件
```

#### 切换目录

```
> cd src
> 进入utils目录
```

#### 查看当前位置

```
> pwd
> where
> 我在哪个目录
```

## 技术实现

### 安全特性

- **沙箱限制**: AI 只能访问当前工作目录及其子目录
- **路径验证**: 防止目录遍历攻击 (`../`)
- **自动备份**: 编辑和删除操作前自动创建备份
- **操作日志**: 所有文件操作都被记录和审计
- **大小限制**: 单个文件最大 10MB

### 文件系统工具模块 (`src/utils/filesystem.js`)

```javascript
// 核心功能
-validatePath() - // 路径安全验证
  listFiles() - // 列出目录内容
  readFile() - // 读取文件
  writeFile() - // 写入文件（自动备份）
  createFile() - // 创建新文件
  deleteFile() - // 删除文件（可选备份）
  getFileInfo() - // 获取文件信息
  changeDirectory() - // 切换目录
  searchFiles() - // 搜索文件
  getOperationLog(); // 获取操作日志
```

### AI Provider 扩展 (`src/providers/base.js`)

- 所有 Provider 现在都继承文件系统功能
- 自动初始化文件系统
- 提供文件上下文给 AI
- 智能识别文件操作意图

### 交互会话增强 (`src/cli/commands/start.js`)

- 智能命令识别（自然语言 + 特殊命令）
- 动态提示符显示当前目录
- 增强的帮助系统
- 操作反馈和错误处理

## 使用示例

### 示例 1: 项目分析

```
> 这个项目有什么文件？
> 读取 package.json 看看依赖
> 查看 src 目录结构
> 创建一个新的工具脚本
```

### 示例 2: 代码编辑

```
> 编辑 config.js 文件
> 在 utils 里创建一个新的格式化工具
> 读取现有的测试文件
> 修改错误处理逻辑
```

### 示例 3: 文件管理

```
> 列出所有 .js 文件
> 搜索包含 "error" 的文件
> 删除临时文件
> 整理项目结构
```

## 配置选项

文件系统功能自动启用，无需额外配置。安全限制包括：

- 工作目录限制：只能访问启动目录及子目录
- 文件大小限制：10MB
- 操作日志：保留最近 1000 条操作

## 故障排除

### 常见问题

1. **"Access denied" 错误**
   - 原因：尝试访问工作目录外的文件
   - 解决：保持在当前目录范围内操作

2. **文件读取失败**
   - 原因：文件不存在或权限不足
   - 解决：检查文件路径和权限

3. **AI 不理解文件操作**
   - 原因：自然语言识别失败
   - 解决：使用更明确的命令或特殊语法

### 调试命令

```
> config      # 查看当前配置
> help        # 显示完整帮助
> clear       # 清屏
```

## 性能考虑

- 大文件处理：使用流式读取，限制 10MB
- 目录遍历：递归搜索可配置深度
- 内存使用：操作日志限制大小
- 响应时间：简单操作即时响应

## 未来扩展

计划中的功能：

1. **Git 集成**: AI 执行 git 操作
2. **代码分析**: 静态分析和重构建议
3. **项目管理**: 自动化项目设置
4. **模板系统**: 快速创建项目文件
5. **插件架构**: 第三方功能扩展

## 相关文件

- `src/utils/filesystem.js` - 文件系统核心
- `src/providers/base.js` - Provider 基类扩展
- `src/providers/deepseek.js` - DeepSeek 实现
- `src/providers/openai.js` - OpenAI 实现
- `src/cli/commands/start.js` - 交互会话增强
- `src/utils/formatter.js` - 帮助信息更新

## 开始使用

现在你可以让 AI 助手帮你：

- 分析项目结构
- 编辑代码文件
- 管理配置文件
- 自动化重复任务

只需用自然语言告诉 AI 你想要做什么！

```bash
# 启动并开始探索
naturecode start

# 然后尝试：
# "显示当前目录"
# "读取 package.json"
# "创建一个新的工具脚本"
```

享受 NatureCode 1.2.4 带来的强大文件系统功能！
